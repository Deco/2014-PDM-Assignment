{% extends "common.html" %}

{% block 'breadcrumb' %}
  <span class="crumb-sep">&gt;</span>
  <span class="crumb-part">Project {{ project.id }}</span>
{% endblock %}

{% block 'body' %}
  <form id="project-form" action="" method="post">{% csrf_token %}
    <div class="col-md-12">
      {% if project_form_commited %}
        <div class="panel panel-success">
          <div class="panel-heading">Your changes have been saved.</div>
        </div>
      {% endif %}
      {% if project_form_bad %}
        <div class="panel panel-danger">
          <div class="panel-heading">There was an error submitting your changes.</div>
          {% if form.non_field_errors %}
            {% for error in form.non_field_errors %}
              <div class="panel-body">
                <strong>&#x2014;</strong>: {{ error }}
              </div>
            {% endfor %}
          {% endif %}
          {% for field in form %}
            {% if field.errors %}
              {% for error in field.errors %}
                <div class="panel-body">
                  <strong>{{ field.label }}</strong>: {{ error }}
                </div>
              {% endfor %}
            {% endif %}
          {% endfor %}
          {% for error in membership_formset.non_field_errors %}
            <div class="panel-body">
              {{ error }}
            </div>
          {% endfor %}
          {% for form in membership_formset %}
            {% for error in form.non_field_errors %}
              <div class="panel-body">
                {{ error }}
              </div>
            {% endfor %}
            {% for field in form %}
              {% if field.errors %}
                {% for error in field.errors %}
                  <div class="panel-body">
                    <strong>{{ field.label }}</strong>: {{ error }}
                  </div>
                {% endfor %}
              {% endif %}
            {% endfor %}
          {% endfor %}
        </div>
      {% endif %}
      <div class="dashboard-div">
        <div class="well list-well">
          <div class="row">
            <div class="col-xs-2 project-info-title-label">
              Project Title:
            </div>
            <div class="col-md-9 project-info-title">
              <div class="project-info-only">
                {{ project_title }}
              </div>
              <div class="project-edit-only project-edit-title">
                {{ form.title }}
              </div>
            </div>
            <div class="col-md-1 project-info-title"></div>
          </div>
          <div class="row">
            <div class="col-xs-2 project-info-detail-label">
              Faculty:
            </div>
            <div class="col-md-5 project-info-detail">
              <div class="project-info-only">
                <a href="/faculty/{{ project_faculty_id }}">{{ project_faculty_name }}</a>
              </div>
              <div class="project-edit-only project-edit-title">
                {{ form.faculty }}
              </div>
            </div>
            <div class="col-xs-2 project-info-detail-label">
              Creation Date:
            </div>
            <div class="col-md-3 project-info-detail">
              {{ project_creation_date }}
            </div>
          </div>
          <div class="row">
            <div class="col-xs-2 project-info-detail-label">
              My Role:
            </div>
            <div class="col-md-5 project-info-detail">
              {{ project_user_role }}
            </div>
            <div class="col-xs-2 project-info-detail-label">
              Update Date:
            </div>
            <div class="col-md-3 project-info-detail">
              {{ project_update_date }}
            </div>
          </div>
          <div class="row">
            <div class="col-xs-2 project-info-detail-label">
              Storage Space:
            </div>
            <div class="col-md-6 project-info-detail">
              <div class="progress progress-striped active project-info-storage-progress">
                <div class="project-info-storage">
                  {{ project_storage_used_mb }}MB of {{ project_storage_capacity_mb }}MB ({{ project_storage_used_percent }}%)
                </div>
                <div class="progress-bar progress-bar project-info-storage-bar" style="width: {{ project_storage_used_percent }}%"> 
                </div>
                <div class="progress-bar progress-bar-info project-info-storage-bar" style="width: {{ project_storage_free_percent }}%"></div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="btn-group">
                {% if project_user_role == "Data Manager" %}
                  <button class="btn btn-default project-info-only">Request Additional Space</button>
                {% endif %}
                <button id="edit-button" class="btn btn-default project-info-only" onClick="return false;">Edit Project</button>
                <button id="submit-button" class="btn btn-success project-edit-only" onClick="return false;">Submit</button>
                <button id="cancel-button" class="btn btn-warning project-edit-only" onClick="return false;">Cancel</button>
              </div>
              <div class="btn-group">
                <a href="/project/{{ project_id }}/delete" class="btn btn-danger project-edit-only">Delete</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-5">
      <div class="dashboard-div">
        <h2><span class="glyphicon glyphicon-user dashboard-icon"></span>Members</h2>
        <div class="well list-well">
          <div id="faculty-box" class="listBox">
            {{ membership_formset.management_form }}
            {% for member_info in project_members %}
              <div class="listEntry list-group-item">
                <span class="listEntryTitle">
                  <div>
                    <a href="/user/{{ member_info.id }}">{{ member_info.first_name }} {{ member_info.last_name }}</a>
                  </div>
                  <div class="project-edit-only">
                    {{ member_info.membership_form.id }}
                    {% if member_info.is_addition %}
                      {{ member_info.membership_form.member }}
                    {% else %}
                      {{ member_info.membership_form.member.as_hidden }}
                    {% endif %}
                    {{ member_info.membership_form.role }}
                  </div>
                  <div class="project-info-only">
                    {{ member_info.role }}
                  </div>
                </span>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-7">
      <div class="dashboard-div">
        <h2><span class="glyphicon glyphicon-th-list dashboard-icon"></span>Request History</h2>
        <div class="well list-well">
          <div id="faculty-box" class="listBox">
            stuff
          </div>
        </div>
      </div>
    </div>
  </form>
  <script>
    $(document).ready(function(){
        
        function showEdit() {
            $(".project-info-only").hide();
            $(".project-edit-only").show();
        }
        function hideEdit() {
            $(".project-info-only").show();
            $(".project-edit-only").hide();
        }
        
        $("#edit-button").click(function(){ showEdit(); })
        $("#cancel-button").click(function(){ hideEdit(); })
        $("#submit-button").click(function(){
            $("#project-form").submit();
        });
        
        $('#id_title').autosize({append: ""});
        $(".project-edit-only").hide();
        $('#id_title').keypress(function(event) {
            if(event.which == '13') {
                return false;
            }
            $('#id_title').autosize({append: ""});
        });
        
        {% if edit_mode %}
          showEdit();
        {% endif %}
    });
  </script>
{% endblock %}

